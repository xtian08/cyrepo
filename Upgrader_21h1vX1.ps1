<#
Script Name: Upgrader_21h1vX1.ps1
v1 : Iso to 20h2.3
v2 : stage cache moved to onedrive
v3 : change cleanup releaseId check to 2009
v4 : added scheduled task to run Launcher by logged user
v5 : Run Cut in background while iso being downloaded
v6 : set imageindex 3 to support 1607
v7 : change ps1 decode to overwrite existing temp files
v8 : 7zip moved to ondrive 
v9 : Downloadblob progress bar on PS or ISE for manual invoke
v10 : Added Exit code if upgrade is performed for landesk reporting
v11 : Add WinScp
v12 : Iso to 20h2.4 / DownloadBlob Migrate to sftp / Progress bar removed
v13 : Iso to 20h2.5
v14 : Scut 1.0.0 update
v15 : Iso to 20H2.6
v16	: Scut July-Sept binary
v1 : Windows !0 21h1.3 
Description: Pre-stages windows 10 (20H2.3) installation media for NYUAD
Author: jevon.weiman@dxc.com - Modified: Chris Mariano xtian@dxc.com
#>

#Kill active SchTask

Set-ExecutionPolicy -ExecutionPolicy Bypass -force
Stop-ScheduledTask -TaskPath "\Windows10Upgrade" -TaskName "LaunchMe"
Stop-ScheduledTask -TaskPath "\Windows10Upgrade" -TaskName "Post-upgrade"
Stop-Process -Name "NYUAD Windows 10 Upgrade"


#PrimeSCP


New-Item -ItemType "directory" -Path "C:\Program Files (x86)\LANDesk\LDClient\sdmcache\AppsPortal\WIN\Scripts"
$stageLD1  = "C:\Program Files (x86)\LANDesk\LDClient\sdmcache\AppsPortal\WIN\Scripts\stage_cacheX2.zip"
$stageLD2  = "C:\Program Files (x86)\LANDesk\LDClient\sdmcache\AppsPortal\WIN\Scripts\WinSCP.zip"
$stageUrl1 = "https://onedrive.live.com/download?cid=526DD67E59DA5B20&resid=526DD67E59DA5B20%21509770&authkey=AHbu9CHU25Ow-0E"
$stageUrl2 = "https://onedrive.live.com/download?cid=526DD67E59DA5B20&resid=526DD67E59DA5B20%21509885&authkey=ALBPH3r_vyFVq3U"
(New-Object System.Net.WebClient).DownloadFile($stageUrl1, $stageLD1)
(New-Object System.Net.WebClient).DownloadFile($stageUrl2, $stageLD2)
Set-Location "C:\Program Files (x86)\LANDesk\LDClient\sdmcache\AppsPortal\WIN\Scripts"
Expand-Archive -Path winscp.Zip -DestinationPath .\winscp

    Import-Module -name "C:\Program Files (x86)\LANDesk\LDClient\sdmcache\AppsPortal\WIN\Scripts\winscp" -Verbose
    # Set credentials to a PSCredential Object.
    $User = "cdm436"
    $scpText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("UgBVAFQAYQBNAE8AVwBuAEsARAB2AGQAQgB3AHgA"))
    $PWord = ConvertTo-SecureString $scpText -AsPlainText -Force
    $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $User, $PWord
    # Create a WinSCP Session.
    $sessionOptions = New-WinSCPSessionOption -Hostname "sftp.abudhabi.nyu.edu" -Protocol Sftp -PortNumber 4410 -Credential $Credential -SshHostKeyFingerprint "ssh-ed25519 255 c1:64:69:dd:07:2a:8f:43:04:89:af:81:35:df:00:b5"
    $session = New-WinSCPSession -SessionOption $sessionOptions



# Test if previously upgraded and if so then perform cleanup
$RealeasId = Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion' -Name DisplayVersion
if ($RealeasId -eq 21H1) {
Set-Location "C:\"
Remove-Item -Recurse -Force -Path 'C:\Program Files\NYUAD IT'
Remove-Item -Force -Path C:\Temp\bypass.ps1
Remove-Item -Force -Path C:\Temp\bypass.xml
Remove-Item -Force -Path C:\Temp\PerformUpgrade.ps1
Remove-Item -Force -Path C:\Temp\postoobe.cmd
Remove-Item -Force -Path C:\Temp\pre-stageB.ps1
Remove-Item -Force -Path C:\Temp\startupgrade.ps1
Remove-Item -Force -Path C:\Temp\UpgradeStrap.ps1
Remove-Item -Force -Path C:\Temp\UninstallStrap.ps1
Remove-Item -Force -Path C:\Temp\PerformUninstall.ps1
Remove-Item -Force -Path C:\Temp\CutMe.ps1
Unregister-ScheduledTask -TaskName "NYUAD Windows 10 - PS Stage" -Confirm:$false
Unregister-ScheduledTask -TaskName "Post-upgrade" -Confirm:$false
Unregister-ScheduledTask -TaskName "LaunchMe" -Confirm:$false
exit 2
}

$DText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("RABYAEMAIQBjADAAbgBuADMAYwB0AA=="))
$Password=ConvertTo-SecureString $DText –asplaintext –force
$UserAccount = Get-LocalUser -Name "ITOps"
$UserAccount | Set-LocalUser -Password $Password

$windowsmediapath = "C:\Program Files\NYUAD IT\Windows 10 upgrade\"
$windowsdatapath = "C:\Program Files\NYUAD IT\Windows 10 upgrade\data\"
$scriptspath  = "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts\"
$7zippath = "C:\Program Files\NYUAD IT\Windows 10 upgrade\7za920\"
$filestatus = "pending"
$cmdpath = 'c:\windows\system32\cmd.exe /c '

#create folder structures
if (Test-Path $windowsmediapath) {}
else {mkdir $windowsdatapath}
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\cut") {}
else {mkdir "C:\Program Files\NYUAD IT\Windows 10 upgrade\cut"}
if (Test-Path $scriptspath) {}
else {mkdir $scriptspath}
if (Test-Path "C:\Temp") {}
else {mkdir C:\Temp}

Set-Location "C:\Program Files\NYUAD IT\Windows 10 upgrade"

#set-execiotion Policy for the session
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope LocalMachine -Force

#tests for the presence of file and if exists tests against known hash, if any tests fail download file
function DownloadBlob{
 
    $filename = $args[0]
    $filehash = $args[1]
    $fileurl = $args[2]
    $filepath = $args[3]
    
    $file = $filepath + $filename

    if (Test-Path $file) {
    if ((Get-FileHash -Algorithm MD5 $file).Hash -eq $filehash) {
        } else {
    Receive-WinSCPItem -WinSCPSession $session -Path $fileurl -Destination $file 
    }
        } else {
    Receive-WinSCPItem -WinSCPSession $session -Path $fileurl -Destination $file
}}


#download blob files
    write-host "downloading...."
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    
    DownloadBlob "7za920.zip" "2FAC454A90AE96021F4FFC607D4C00F8" "/upload/7za920.zip" $windowsmediapath
    #DownloadBlob "winscp.zip" "84E4AA611652C2E5E81EF243EBA11722" "https://github.com/dotps1/WinSCP/releases/download/WinSCP-PowerShell-v5.17.10.0/WinSCP.zip" $windowsmediapath


#prime 7z
if (Test-Path $7zippath){} else {Expand-Archive .\7za920.zip -DestinationPath .\7za920}


#extract staged_cache
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\WPy32-3850\python-3.8.5\"){}
else {
    $7ZipPath = "'C:\Program Files\NYUAD IT\Windows 10 upgrade\7za920\7za.exe'"
    $zipFile = "'C:\program files (x86)\landesk\ldclient\sdmcache\appsportal\win\scripts\stage_cachex2.zip'"
    $cutdest = "'C:\Program Files\NYUAD IT\Windows 10 upgrade\'"
    $primecommand = "& $7ZipPath x -o$cutdest -y -tzip $zipFile"
    iex $primecommand}


if (Test-Path "C:\temp\startupgrade.ps1"){}
else {
    New-Item -ItemType File -Name "startupgrade.ps1" -Path $scriptspath
    $EncodedText = "PAAjAA0ACgBNAG8AdQBuAHQAIABpAG4AcwB0AGEAbABsAGEAdABpAG8AbgAgAG0AZQBkAGkAYQAgAGEAbgBkACAAcABlAGYAbwByAG0AIABwAHIAZQAtAGYAbABpAGcAaAB0ACAAYwBoAGUAYwBrAHMAIABwAHIAaQBvAHIAIAB0AG8AIAB1AHAAZwByAGEAZABlACwAIABzAGgAbwB1AGwAZAAgAHAAcgBlAC0AZgBsAGkAZwBoAHQAIABjAGgAZQBjAGsAcwAgAHMAdQBjAGMAZQBlAGQAIAB0AGgAZQBuACAAYgBlAGcAaQBuACAAdQBwAGcAcgBhAGQAZQAgAHAAcgBvAGMAZQBzAHMADQAKACMAPgANAAoADQAKACQAbQBvAHUAbgB0AFIAZQBzAHUAbAB0ACAAPQAgAE0AbwB1AG4AdAAtAEQAaQBzAGsASQBtAGEAZwBlACAAJwBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABkAGEAdABhAFwAdwBpAG4AZABvAHcAcwAxADAALgBpAHMAbwAnACAALQBQAGEAcwBzAFQAaAByAHUADQAKACQAbQBvAHUAbgB0AFIAZQBzAHUAbAB0ACAAfAAgAEcAZQB0AC0AVgBvAGwAdQBtAGUADQAKACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACAAPQAgACgAJABtAG8AdQBuAHQAUgBlAHMAdQBsAHQAIAB8ACAARwBlAHQALQBWAG8AbAB1AG0AZQApAC4ARAByAGkAdgBlAEwAZQB0AHQAZQByAA0ACgBTAGUAdAAtAEwAbwBjAGEAdABpAG8AbgAgACIAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlACIADQAKACQAYwBtAGQAcABhAHQAaAAgAD0AIAAnAGMAOgBcAHcAaQBuAGQAbwB3AHMAXABzAHkAcwB0AGUAbQAzADIAXABjAG0AZAAuAGUAeABlACAALwBjACAAJwANAAoAJABzAHQAYQByAHQAcwBlAHQAdQBwACAAPQAgACIAJgAgACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACIAIAArACAAJwA6AFwAcwBlAHQAdQBwAC4AZQB4AGUAIAAvAEEAdQB0AG8AIABVAHAAZwByAGEAZABlACAALwBRAHUAaQBlAHQAIAAvAEQAeQBuAGEAbQBpAGMAVQBwAGQAYQB0AGUAIABEAGkAcwBhAGIAbABlACAALwBzAGgAbwB3AG8AbwBiAGUAIABOAG8AbgBlACAALwBUAGUAbABlAG0AZQB0AHIAeQAgAEQAaQBzAGEAYgBsAGUAJwANAAoAaQBlAHgAIAAkAHMAdABhAHIAdABzAGUAdAB1AHAA"
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "c:\temp\startupgrade.ps1" -Value $DecodedText
    }

#generate script - perform upgrade ps1 (overwrite if exist)
#if (Test-Path "C:\Temp\PerformUpgrade.ps1"){}
#else {
    Remove-Item -Force -Path C:\Temp\PerformUpgrade.ps1
    New-Item -ItemType File -Name "PerformUpgrade.ps1" -Path "c:\temp\"
    $EncodedText = "PAAjAAoACgBTAGMAcgBpAHAAdAAgAE4AYQBtAGUAOgAgAFAAZQByAGYAbwByAG0AVQBwAGcAcgBhAGQAZQAuAHAAcwAxAAoACgBWAGUAcgBzAGkAbwBuADoAIAAxAAoACgBEAGUAcwBjAHIAaQBwAHQAaQBvAG4AOgAgAEUAeABwAG8AcgB0AHMAIABBAHAAcABsAGkAYwBhAHQAaQBvAG4AIABmAGkAbABlACAAdAB5AHAAZQAgAGEAcwBzAG8AYwBpAGEAdABpAG8AbgBzACwAIABUAGUAcwB0AHMAIABBAHAAZQB4ACAAdgBlAHIAcwBpAG8AbgAgAGEAbgBkACAAcgBlAG0AbwB2AGUAcwAvAHUAcABnAHIAYQBkAGUAcwAgAGkAZgAgAG4AZQBlAGQAZQBkAAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFMAdABhAHIAdABzACAAdQBwAGcAcgBhAGQAZQAgAHAAcgBvAGMAZQBzAHMACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAATQBvAGQAaQBmAGkAZQBzACAAUABvAHcAZQByACAAcwBjAGgAZQBtAGUAIAB0AG8AIABtAGEAeAAgAHMAZQB0AHQAaQBuAGcAcwAKAAoAQQB1AHQAaABvAHIAOgAgAGoAZQB2AG8AbgAuAHcAZQBpAG0AYQBuAEAAZAB4AGMALgBjAG8AbQAKAAoAIwA+AAoACgAKAAoAUwBlAHQALQBMAG8AYwBhAHQAaQBvAG4AIAAiAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAXABOAFkAVQBBAEQAIABJAFQAXABXAGkAbgBkAG8AdwBzACAAMQAwACAAdQBwAGcAcgBhAGQAZQAiAAoACgAkAGMAbQBkAHAAYQB0AGgAIAA9ACAAJwBjADoAXAB3AGkAbgBkAG8AdwBzAFwAcwB5AHMAdABlAG0AMwAyAFwAYwBtAGQALgBlAHgAZQAgAC8AYwAgACcACgAKACQAQQBwAGUAeABQAGEAdABoAD0AIgBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzACAAKAB4ADgANgApAFwAVAByAGUAbgBkACAATQBpAGMAcgBvAFwATwBmAGYAaQBjAGUAUwBjAGEAbgAgAEMAbABpAGUAbgB0AFwAUABjAGMATgBUAE0AbwBuAC4AZQB4AGUAIgAKAAoAJABBAHAAZQB4AFMAdABhAHQAZQAgAD0AIAAiAHAAZQBuAGQAaQBuAGcAIgAKAAoACgAKACMAZABpAHMAYQBiAGwAZQAgAHAAbwB3AGUAcgAgAHMAYQB2AGkAbgBnAHMAIABtAG8AZABlAHMACgAKAEkAbgB2AG8AawBlAC0ARQB4AHAAcgBlAHMAcwBpAG8AbgAgACIAJABjAG0AZABwAGEAdABoAC4AXABzAGMAcgBpAHAAdABzAFwAcABvAHcAZQByAHMAYwBoAGUAbQBlAC4AYwBtAGQAIABpAG4AaQB0AC4AYwBtAGQAIgAgAAoACgAKAAoAIwBlAHgAcABvAHIAdABpAG4AZwAgAGQAZQBmAGEAdQBsAHQAIABhAHAAcAAgAGEAcwBzAG8AYwBpAGEAdABpAG8AbgBzAAoACgBTAGUAdAAtAEwAbwBjAGEAdABpAG8AbgAgACIAQwA6AFwAVwBpAG4AZABvAHcAcwBcAFMAeQBzAHQAZQBtADMAMgBcACIACgAKAGMAcAAgAC4AXABPAEUATQBEAGUAZgBhAHUAbAB0AEEAcwBzAG8AYwBpAGEAdABpAG8AbgBzAC4AeABtAGwAIAAuAFwATwBFAE0ARABlAGYAYQB1AGwAdABBAHMAcwBvAGMAaQBhAHQAaQBvAG4AcwBfAGIAYQBjAGsAdQBwAHcAMQAwAHUAcABnAC4AeABtAGwACgAKAGQAZQBsACAALgBcAE8ARQBNAEQAZQBmAGEAdQBsAHQAQQBzAHMAbwBjAGkAYQB0AGkAbwBuAHMALgB4AG0AbAAKAAoAaQBlAHgAIAAnAEQAaQBzAG0ALgBlAHgAZQAgAC8AbwBuAGwAaQBuAGUAIAAvAEUAeABwAG8AcgB0AC0ARABlAGYAYQB1AGwAdABBAHAAcABBAHMAcwBvAGMAaQBhAHQAaQBvAG4AcwA6ACIAYwA6AFwAdwBpAG4AZABvAHcAcwBcAHMAeQBzAHQAZQBtADMAMgBcAE8ARQBNAEQAZQBmAGEAdQBsAHQAQQBzAHMAbwBjAGkAYQB0AGkAbwBuAHMALgB4AG0AbAAiACcACgAKAHMAZQB0AC0ASQB0AGUAbQBQAHIAbwBwAGUAcgB0AHkAIAAtAFAAYQB0AGgAIABIAEsATABNADoAXABTAE8ARgBUAFcAQQBSAEUAXABQAG8AbABpAGMAaQBlAHMAXABNAGkAYwByAG8AcwBvAGYAdABcAFcAaQBuAGQAbwB3AHMAXABTAHkAcwB0AGUAbQAgAC0ATgBhAG0AZQAgAEQAZQBmAGEAdQBsAHQAQQBzAHMAbwBjAGkAYQB0AGkAbwBuAHMAQwBvAG4AZgBpAGcAdQByAGEAdABpAG8AbgAgAC0AVgBhAGwAdQBlACAAJwBDADoAXABXAGkAbgBkAG8AdwBzAFwAUwB5AHMAdABlAG0AMwAyAFwATwBFAE0ARABlAGYAYQB1AGwAdABBAHMAcwBvAGMAaQBhAHQAaQBvAG4AcwAuAHgAbQBsACcACgAKAAoACgAjAEMAdQB0ACAAQQBwAGUAeAAgAGkAZgAgAG4AZQBlAGQAZQBkAAoACgBJAGYAIAAoAFQAZQBzAHQALQBQAGEAdABoACAAJABBAHAAZQB4AFAAYQB0AGgAKQAgAHsACgAKACAAIAAgACAAJABBAHAAZQB4AFYAZQByAHMAaQBvAG4APQAoAEcAZQB0AC0AQwBoAGkAbABkAEkAdABlAG0AIAAiAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAIAAoAHgAOAA2ACkAXABUAHIAZQBuAGQAIABNAGkAYwByAG8AXABPAGYAZgBpAGMAZQBTAGMAYQBuACAAQwBsAGkAZQBuAHQAXABQAGMAYwBOAFQATQBvAG4ALgBlAHgAZQAiACkALgBWAGUAcgBzAGkAbwBuAEkAbgBmAG8ALgBGAGkAbABlAFYAZQByAHMAaQBvAG4ACgAgACAACgAgACAAIAAgAEkAZgAgACgAJABBAHAAZQB4AFYAZQByAHMAaQBvAG4AIAAtAGcAZQAgADEANAAuADAALgAwAC4AOQA3ADIAMgApACAAewAKAAoAIAAgACAAIAAkAEEAcABlAHgAUwB0AGEAdABlACAAPQAgACIAUgBlAGEAZAB5ACIACgAKACAAIAAgACAAfQAKAAoAIAAgACAAIABlAGwAcwBlACAAewAKAAoAIAAgACAAIAAkADcAWgBpAHAAUABhAHQAaAAgAD0AIAAiACcAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlAFwANwB6AGEAOQAyADAAXAA3AHoAYQAuAGUAeABlACcAIgAKAAoAIAAgACAAIAAkAHoAaQBwAEYAaQBsAGUAIAA9ACAAIgAnAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAXABOAFkAVQBBAEQAIABJAFQAXABXAGkAbgBkAG8AdwBzACAAMQAwACAAdQBwAGcAcgBhAGQAZQBcAGQAYQB0AGEAXABzAGMAdQB0AF8AMQAuADAALgAwAC4AegBpAHAAJwAiAAoACgAgACAAIAAgACQAYwB1AHQAZABlAHMAdAAgAD0AIAAiACcAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlAFwAYwB1AHQAJwAiAAoACgAgACAAIAAgACQARABlAGMAbwBkAGUAZAAgAD0AIABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAJwBkAEEAQgB5AEEARwBVAEEAYgBnAEIAawBBAEEAPQA9ACcAKQApAAoACgAgACAAIAAgACQAYwB1AHQAYwBvAG0AbQBhAG4AZAAgAD0AIAAiACYAIAAkADcAWgBpAHAAUABhAHQAaAAgAGUAIAAtAG8AJABjAHUAdABkAGUAcwB0ACAALQB5ACAALQB0AHoAaQBwACAALQBwACQARABlAGMAbwBkAGUAZAAgACQAegBpAHAARgBpAGwAZQAiAAoACgAgACAAIAAgAGkAZQB4ACAAJABjAHUAdABjAG8AbQBtAGEAbgBkAAoACgAgACAAIAAgACQAYwB1AHQAYwBvAG0AbQBhAG4AZAAgAD0AIAAiACYAIAAnAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAXABOAFkAVQBBAEQAIABJAFQAXABXAGkAbgBkAG8AdwBzACAAMQAwACAAdQBwAGcAcgBhAGQAZQBcAGMAdQB0AFwAcwBjAHUAdAAuAGUAeABlACcAIAAtAG4AbwBpAG4AcwB0AGEAbABsACIACgAKACAAIAAgACAAaQBlAHgAIAAkAGMAdQB0AGMAbwBtAG0AYQBuAGQACgAKACAAIAAgACAAJABBAHAAZQB4AFMAdABhAHQAZQAgAD0AIAAiAFAAZQBuAGQAaQBuAGcAIgAKAAoAIAAgACAAIAB9AAoACgAgACAAIAAgAH0ACgAKAAoACgAKAAoAIwBXAGEAaQB0ACAAZgBvAHIAIABDAHUAdAAgAFAAcgBvAGMAZQBzAHMAIAB0AG8AIABjAG8AbQBwAGwAZQB0AGUACgAKAGQAbwB7AAoACgAgACAAIAAgACQAUAByAG8AYwAgAD0AIABHAGUAdAAtAFAAcgBvAGMAZQBzAHMAIABzAGMAdQB0ACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlAAoACgAgACAAIAAgAFMAdABhAHIAdAAtAFMAbABlAGUAcAAgADEACgAKAH0AdQBuAHQAaQBsACgAJABQAHIAbwBjACAALQBlAHEAIAAkAE4AdQBsAGwAKQAKAAoACgAKACMASQBuAHMAdABhAGwAbAAgAEEAcABlAHgAIABvAG4AZQAgAGkAZgAgAG4AZQBlAGQAZQBkAAoACgBpAGYAIAAoACQAQQBwAGUAeABTAHQAYQB0AGUAIAA9ACAAIgBQAGUAbgBkAGkAbgBnACIAKQAgAHsAKABTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAIgBtAHMAaQBlAHgAZQBjAC4AZQB4AGUAIgAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIAAiAC8AaQAgACIAIgBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABkAGEAdABhAFwAYQBnAGUAbgB0AF8AYwBsAG8AdQBkAF8AeAA2ADQAXwBzAGEAYQBzAC4AbQBzAGkAIgAiACAALwBxAHUAaQBlAHQAIAAvAG4AbwByAGUAcwB0AGEAcgB0ACIAIAAtAE4AbwBOAGUAdwBXAGkAbgBkAG8AdwAgAC0AUABhAHMAcwBUAGgAcgB1ACkALgBFAHgAaQB0AEMAbwBkAGUAfQAKAAoACgAKACQAbQBvAHUAbgB0AFIAZQBzAHUAbAB0ACAAPQAgAE0AbwB1AG4AdAAtAEQAaQBzAGsASQBtAGEAZwBlACAAJwBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABkAGEAdABhAFwAdwBpAG4AZABvAHcAcwAxADAALgBpAHMAbwAnACAALQBQAGEAcwBzAFQAaAByAHUACgAKACQAbQBvAHUAbgB0AFIAZQBzAHUAbAB0ACAAfAAgAEcAZQB0AC0AVgBvAGwAdQBtAGUACgAKACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACAAPQAgACgAJABtAG8AdQBuAHQAUgBlAHMAdQBsAHQAIAB8ACAARwBlAHQALQBWAG8AbAB1AG0AZQApAC4ARAByAGkAdgBlAEwAZQB0AHQAZQByAAoACgBTAGUAdAAtAEwAbwBjAGEAdABpAG8AbgAgACIAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlACIACgAKACQAYwBtAGQAcABhAHQAaAAgAD0AIAAnAGMAOgBcAHcAaQBuAGQAbwB3AHMAXABzAHkAcwB0AGUAbQAzADIAXABjAG0AZAAuAGUAeABlACAALwBjACAAJwAKAAoAJABzAHQAYQByAHQAcwBlAHQAdQBwACAAPQAgACIAJgAgACQAZAByAGkAdgBlAEwAZQB0AHQAZQByACIAIAArACAAJwA6AFwAcwBlAHQAdQBwAC4AZQB4AGUAIAAvAEEAdQB0AG8AIABVAHAAZwByAGEAZABlACAALwBEAHkAbgBhAG0AaQBjAFUAcABkAGEAdABlACAARABpAHMAYQBiAGwAZQAgAC8AcwBoAG8AdwBvAG8AYgBlACAATgBvAG4AZQAgAC8AVABlAGwAZQBtAGUAdAByAHkAIABEAGkAcwBhAGIAbABlACAALwBpAG0AYQBnAGUAaQBuAGQAZQB4ACAAMwAnAAoACgBpAGUAeAAgACQAcwB0AGEAcgB0AHMAZQB0AHUAcAAKAA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "C:\Temp\PerformUpgrade.ps1" -Value $DecodedText
#   }

#generate script - upgrade boot strap ps1
if (Test-Path "C:\Temp\UpgradeStrap.ps1"){}
else {
    New-Item -ItemType File -Name "UpgradeStrap.ps1" -Path "c:\temp"
    $value = '
$ProcessArguments = "c:\temp\PerformUpgrade.ps1"
(Start-Process -FilePath "powershell.exe " -ArgumentList $ProcessArguments -WorkingDirectory $env:windir -WindowStyle hidden -Verb "runAs")
    '
    Set-Content -Path "C:\Temp\UpgradeStrap.ps1" -Value $value
    }

#generate script - upgrade ps1
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts\upgrade.ps1"){}
else {
    New-Item -ItemType File -Name "upgrade.ps1" -Path $scriptspath
    $value = '
$DText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("RABYAEMAIQBjADAAbgBuADMAYwB0AA=="))
$Password=ConvertTo-SecureString $DText –asplaintext –force
$Cred = New-Object System.Management.Automation.PSCredential ("ITOps", $Password)
$ProcessArguments = "c:\temp\UpgradeStrap.ps1"
(Start-Process -FilePath "powershell.exe " -Credential $Cred -ArgumentList $ProcessArguments -WorkingDirectory $env:windir -WindowStyle hidden -PassThru).WaitForExit()
    '
    Set-Content -Path "$scriptspath\upgrade.ps1" -Value $value
    }

#generate script - uninstall ps1
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts\Uninstall.ps1"){}
else {
    New-Item -ItemType File -Name "Uninstall.ps1" -Path $scriptspath
    $value = '
$DText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("RABYAEMAIQBjADAAbgBuADMAYwB0AA=="))
$Password=ConvertTo-SecureString $DText –asplaintext –force
$Cred = New-Object System.Management.Automation.PSCredential ("ITOps", $Password)
$ProcessArguments = "c:\temp\UninstallStrap.ps1"
(Start-Process -FilePath "powershell.exe " -Credential $Cred -ArgumentList $ProcessArguments -WorkingDirectory $env:windir -WindowStyle hidden -PassThru).WaitForExit()
    '
    Set-Content -Path "$scriptspath\Uninstall.ps1" -Value $value
    }

#generate script - uninstall boot strap ps1
if (Test-Path "C:\Temp\UninstallStrap.ps1"){}
else {
    New-Item -ItemType File -Name "UninstallStrap.ps1" -Path "c:\temp"
    $value = '
$ProcessArguments = "c:\temp\PerformUninstall.ps1"
(Start-Process -FilePath "powershell.exe " -ArgumentList $ProcessArguments -WorkingDirectory $env:windir -WindowStyle hidden -Verb "runAs")
    '
    Set-Content -Path "C:\Temp\UninstallStrap.ps1" -Value $value
    }

#generate script - perform uninstall ps1 (overwrite if exist)
#if (Test-Path "C:\Temp\PerformUninstall.ps1"){}
#else {
    Remove-Item -Force -Path C:\Temp\PerformUninstall.ps1
    New-Item -ItemType File -Name "PerformUninstall.ps1" -Path "c:\temp\"
    $EncodedText = "PAAjAAoAUABvAHMAdAAgAFUAcABnAHIAYQBkAGUAIABTAGMAcgBpAHAAdAA6AAoAYwBsAGUAYQBuAHUAcAAKACMAPgAKAAoAJABSAGUAYQBsAGUAYQBzAEkAZAAgAD0AIABHAGUAdAAtAEkAdABlAG0AUAByAG8AcABlAHIAdAB5AFYAYQBsAHUAZQAgACcASABLAEwATQA6AFwAUwBPAEYAVABXAEEAUgBFAFwATQBpAGMAcgBvAHMAbwBmAHQAXABXAGkAbgBkAG8AdwBzACAATgBUAFwAQwB1AHIAcgBlAG4AdABWAGUAcgBzAGkAbwBuACcAIAAtAE4AYQBtAGUAIABEAGkAcwBwAGwAYQB5AFYAZQByAHMAaQBvAG4ACgBpAGYAIAAoACQAUgBlAGEAbABlAGEAcwBJAGQAIAAtAGUAcQAgADIAMQBoADEAKQAgAHsACgBTAGUAdAAtAEwAbwBjAGEAdABpAG8AbgAgACIAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlACIACgAkAGMAbQBkAHAAYQB0AGgAIAA9ACAAJwBjADoAXAB3AGkAbgBkAG8AdwBzAFwAcwB5AHMAdABlAG0AMwAyAFwAYwBtAGQALgBlAHgAZQAgAC8AYwAgACcACgBbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4ARQB2AGUAbgB0AEwAbwBnAF0AOgA6AEQAZQBsAGUAdABlAEUAdgBlAG4AdABTAG8AdQByAGMAZQAoACIATgBZAFUAQQBEAFcAMQAwAFUAcAAiACkACgAjAFIAZQBzAHQAbwByAGUAIABQAG8AdwBlAHIAIABzAGUAdAB0AGkAbgBnAHMACgBJAG4AdgBvAGsAZQAtAEUAeABwAHIAZQBzAHMAaQBvAG4AIAAiACQAYwBtAGQAcABhAHQAaAAuAFwAcwBjAHIAaQBwAHQAcwBcAHIAZQBzAHQAbwByAGUAcABvAHcAZQByAHMAYwBoAGUAbQBlAC4AYwBtAGQAIABpAG4AaQB0AC4AYwBtAGQAIgAKACMAUgBlAHMAdABvAHIAZQAgAEYAaQBsAGUAIABhAHMAcwBvAGMAaQBhAHQAaQBvAG4AcwAKAFMAdABvAHAALQBQAHIAbwBjAGUAcwBzACAALQBOAGEAbQBlACAAIgBOAFkAVQBBAEQAIABXAGkAbgBkAG8AdwBzACAAMQAwACAAVQBwAGcAcgBhAGQAZQAiAAoAUwBlAHQALQBMAG8AYwBhAHQAaQBvAG4AIAAiAEMAOgBcACIACgBSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAtAFIAZQBjAHUAcgBzAGUAIAAtAEYAbwByAGMAZQAgAC0AUABhAHQAaAAgACcAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVAAnAAoAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAALQBGAG8AcgBjAGUAIAAtAFAAYQB0AGgAIABDADoAXABUAGUAbQBwAFwAYgB5AHAAYQBzAHMALgBwAHMAMQAKAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0ARgBvAHIAYwBlACAALQBQAGEAdABoACAAQwA6AFwAVABlAG0AcABcAGIAeQBwAGEAcwBzAC4AeABtAGwACgBSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAtAEYAbwByAGMAZQAgAC0AUABhAHQAaAAgAEMAOgBcAFQAZQBtAHAAXABQAGUAcgBmAG8AcgBtAFUAcABnAHIAYQBkAGUALgBwAHMAMQAKAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0ARgBvAHIAYwBlACAALQBQAGEAdABoACAAQwA6AFwAVABlAG0AcABcAHAAbwBzAHQAbwBvAGIAZQAuAGMAbQBkAAoAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAALQBGAG8AcgBjAGUAIAAtAFAAYQB0AGgAIABDADoAXABUAGUAbQBwAFwAcAByAGUALQBzAHQAYQBnAGUAQgAuAHAAcwAxAAoAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAALQBGAG8AcgBjAGUAIAAtAFAAYQB0AGgAIABDADoAXABUAGUAbQBwAFwAcwB0AGEAcgB0AHUAcABnAHIAYQBkAGUALgBwAHMAMQAKAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0ARgBvAHIAYwBlACAALQBQAGEAdABoACAAQwA6AFwAVABlAG0AcABcAFUAcABnAHIAYQBkAGUAUwB0AHIAYQBwAC4AcABzADEACgBSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAtAEYAbwByAGMAZQAgAC0AUABhAHQAaAAgAEMAOgBcAFQAZQBtAHAAXABVAG4AaQBuAHMAdABhAGwAbABTAHQAcgBhAHAALgBwAHMAMQAKAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0ARgBvAHIAYwBlACAALQBQAGEAdABoACAAQwA6AFwAVABlAG0AcABcAFAAZQByAGYAbwByAG0AVQBuAGkAbgBzAHQAYQBsAGwALgBwAHMAMQAKAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0ARgBvAHIAYwBlACAALQBQAGEAdABoACAAQwA6AFwAVABlAG0AcABcAEMAdQB0AE0AZQAuAHAAcwAxAAoAVQBuAHIAZQBnAGkAcwB0AGUAcgAtAFMAYwBoAGUAZAB1AGwAZQBkAFQAYQBzAGsAIAAtAFQAYQBzAGsATgBhAG0AZQAgACIATgBZAFUAQQBEACAAVwBpAG4AZABvAHcAcwAgADEAMAAgAC0AIABQAFMAIABTAHQAYQBnAGUAIgAgAC0AQwBvAG4AZgBpAHIAbQA6ACQAZgBhAGwAcwBlAAoAVQBuAHIAZQBnAGkAcwB0AGUAcgAtAFMAYwBoAGUAZAB1AGwAZQBkAFQAYQBzAGsAIAAtAFQAYQBzAGsATgBhAG0AZQAgACIAUABvAHMAdAAtAHUAcABnAHIAYQBkAGUAIgAgAC0AQwBvAG4AZgBpAHIAbQA6ACQAZgBhAGwAcwBlAAoAVQBuAHIAZQBnAGkAcwB0AGUAcgAtAFMAYwBoAGUAZAB1AGwAZQBkAFQAYQBzAGsAIAAtAFQAYQBzAGsATgBhAG0AZQAgACIATABhAHUAbgBjAGgATQBlACIAIAAtAEMAbwBuAGYAaQByAG0AOgAkAGYAYQBsAHMAZQAKAAoAIwBDAHIAZQBhAHQAZQAgAG4AZQB3ACAAQQBDAEwACgAkAGEAYwBsACAAPQAgAEcAZQB0AC0AQQBjAGwAIAAiAGgAawBsAG0AOgBcAFMAWQBTAFQARQBNAFwAQwB1AHIAcgBlAG4AdABDAG8AbgB0AHIAbwBsAFMAZQB0AFwAUwBlAHIAdgBpAGMAZQBzAFwAbQBwAHMAcwB2AGMAIgAKACQAcABlAHIAcwBvAG4AIAA9ACAAWwBTAHkAcwB0AGUAbQAuAFMAZQBjAHUAcgBpAHQAeQAuAFAAcgBpAG4AYwBpAHAAYQBsAC4ATgBUAEEAYwBjAG8AdQBuAHQAXQAiAE4AVAAgAFMARQBSAFYASQBDAEUAXABNAHAAcwBTAHYAYwAiACAAIAAgACAAIAAgACAAIAAgACAACgAkAGEAYwBjAGUAcwBzACAAPQAgAFsAUwB5AHMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBBAGMAYwBlAHMAcwBDAG8AbgB0AHIAbwBsAC4AUgBlAGcAaQBzAHQAcgB5AFIAaQBnAGgAdABzAF0AIgBGAHUAbABsAEMAbwBuAHQAcgBvAGwAIgAKACQAaQBuAGgAZQByAGkAdABhAG4AYwBlACAAPQAgAFsAUwB5AHMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBBAGMAYwBlAHMAcwBDAG8AbgB0AHIAbwBsAC4ASQBuAGgAZQByAGkAdABhAG4AYwBlAEYAbABhAGcAcwBdACIAQwBvAG4AdABhAGkAbgBlAHIASQBuAGgAZQByAGkAdAAsAE8AYgBqAGUAYwB0AEkAbgBoAGUAcgBpAHQAIgAKACQAcAByAG8AcABhAGcAYQB0AGkAbwBuACAAPQAgAFsAUwB5AHMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBBAGMAYwBlAHMAcwBDAG8AbgB0AHIAbwBsAC4AUAByAG8AcABhAGcAYQB0AGkAbwBuAEYAbABhAGcAcwBdACIATgBvAG4AZQAiAAoAJAB0AHkAcABlACAAPQAgAFsAUwB5AHMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBBAGMAYwBlAHMAcwBDAG8AbgB0AHIAbwBsAC4AQQBjAGMAZQBzAHMAQwBvAG4AdAByAG8AbABUAHkAcABlAF0AIgBBAGwAbABvAHcAIgAKACQAcgB1AGwAZQAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBBAGMAYwBlAHMAcwBDAG8AbgB0AHIAbwBsAC4AUgBlAGcAaQBzAHQAcgB5AEEAYwBjAGUAcwBzAFIAdQBsAGUAKAAkAHAAZQByAHMAbwBuACwAJABhAGMAYwBlAHMAcwAsACQAaQBuAGgAZQByAGkAdABhAG4AYwBlACwAJABwAHIAbwBwAGEAZwBhAHQAaQBvAG4ALAAkAHQAeQBwAGUAKQAKACQAYQBjAGwALgBBAGQAZABBAGMAYwBlAHMAcwBSAHUAbABlACgAJAByAHUAbABlACkACgAkAGEAYwBsACAAfABTAGUAdAAtAEEAYwBsAAoACgAkAGEAYwBsACAAPQAgAEcAZQB0AC0AQQBjAGwAIAAiAGgAawBsAG0AOgBcAFMAWQBTAFQARQBNAFwAQwB1AHIAcgBlAG4AdABDAG8AbgB0AHIAbwBsAFMAZQB0AFwAUwBlAHIAdgBpAGMAZQBzAFwAbQBwAHMAcwB2AGMAXABQAGEAcgBhAG0AZQB0AGUAcgBzAFwAQQBwAHAAQwBzACIACgAkAHIAdQBsAGUAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4AUwBlAGMAdQByAGkAdAB5AC4AQQBjAGMAZQBzAHMAQwBvAG4AdAByAG8AbAAuAFIAZQBnAGkAcwB0AHIAeQBBAGMAYwBlAHMAcwBSAHUAbABlACgAJABwAGUAcgBzAG8AbgAsACQAYQBjAGMAZQBzAHMALAAkAGkAbgBoAGUAcgBpAHQAYQBuAGMAZQAsACQAcAByAG8AcABhAGcAYQB0AGkAbwBuACwAJAB0AHkAcABlACkACgAkAGEAYwBsAC4AQQBkAGQAQQBjAGMAZQBzAHMAUgB1AGwAZQAoACQAcgB1AGwAZQApAAoAJABhAGMAbAAgAHwAUwBlAHQALQBBAGMAbAAKAAoAIwBlAHgAcABvAHIAdABpAG4AZwAgAGQAZQBmAGEAdQBsAHQAIABhAHAAcAAgAGEAcwBzAG8AYwBpAGEAdABpAG8AbgBzAAoAUwBlAHQALQBMAG8AYwBhAHQAaQBvAG4AIAAiAEMAOgBcAFcAaQBuAGQAbwB3AHMAXABTAHkAcwB0AGUAbQAzADIAXAAiAAoAZABlAGwAIAAuAFwATwBFAE0ARABlAGYAYQB1AGwAdABBAHMAcwBvAGMAaQBhAHQAaQBvAG4AcwAuAHgAbQBsAAoAYwBwACAALgBcAE8ARQBNAEQAZQBmAGEAdQBsAHQAQQBzAHMAbwBjAGkAYQB0AGkAbwBuAHMAXwBiAGEAYwBrAHUAcAB3ADEAMAB1AHAAZwAuAHgAbQBsACAALgBcAE8ARQBNAEQAZQBmAGEAdQBsAHQAQQBzAHMAbwBjAGkAYQB0AGkAbwBuAHMALgB4AG0AbAAKAAoAaQBlAHgAIAAiAEMAOgBcAFcAaQBuAGQAbwB3AHMAMQAwAFUAcABnAHIAYQBkAGUAXABXAGkAbgBkAG8AdwBzADEAMABVAHAAZwByAGEAZABlAHIAQQBwAHAALgBlAHgAZQAgAC8ARgBvAHIAYwBlAFUAbgBpAG4AcwB0AGEAbABsACIACgAKAHMAbABlAGUAcAAgADUACgBSAGUAcwB0AGEAcgB0AC0AQwBvAG0AcAB1AHQAZQByAAoAUwBlAHQALQBFAHgAZQBjAHUAdABpAG8AbgBQAG8AbABpAGMAeQAgAC0ARQB4AGUAYwB1AHQAaQBvAG4AUABvAGwAaQBjAHkAIABSAGUAcwB0AHIAaQBjAHQAZQBkACAALQBGAG8AcgBjAGUACgB9AAoARQBsAHMAZQAgAHsAfQAKAAoACgAKAA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "C:\Temp\PerformUninstall.ps1" -Value $DecodedText
#    }

#generate script - powerscheme cmd
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts\powerscheme.cmd"){}
else {
    New-Item -ItemType File -Name "powerscheme.cmd" -Path $scriptspath
    $EncodedText = "DQAKAGkAZgAgAG4AbwB0ACAAZQB4AGkAcwB0ACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABTAHkAcwB0AGUAbQAzADIAXABwAG8AdwBlAHIAYwBmAGcALgBlAHgAZQAgAGcAbwB0AG8AIABTAGsAaQBwAFAAbwB3AGUAcgBDAGYAZwANAAoAaQBmACAAZQB4AGkAcwB0ACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AYQBjAHQALgB0AHgAdAAgAGcAbwB0AG8AIABTAGsAaQBwAFAAbwB3AGUAcgBDAGYAZwANAAoAaQBmACAAZQB4AGkAcwB0ACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AdABlAG0AcAAuAHQAeAB0ACAAZwBvAHQAbwAgAFMAawBpAHAAUABvAHcAZQByAEMAZgBnAA0ACgBlAGMAaABvACAAQwByAGUAYQB0AGkAbgBnACAAdABlAG0AcABvAHIAYQByAHkAIABwAG8AdwBlAHIAIABzAGMAaABlAG0AZQAuAC4ALgANAAoAZgBvAHIAIAAvAEYAIAAiAHQAbwBrAGUAbgBzAD0AMgAgAGQAZQBsAGkAbQBzAD0AOgAoACIAIAAlACUAaQAgAGkAbgAgACgAJwAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAHAAbwB3AGUAcgBjAGYAZwAuAGUAeABlACAALQBnAGUAdABhAGMAdABpAHYAZQBzAGMAaABlAG0AZQAnACkAIABkAG8AIABlAGMAaABvACAAJQAlAGkAPgAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHcAbwB1AGIAYQBrAC0AcAB3AHIAcwBjAGgAZQBtAGUALQBhAGMAdAAuAHQAeAB0AA0ACgBmAG8AcgAgAC8ARgAgACUAJQBpACAAaQBuACAAKAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHcAbwB1AGIAYQBrAC0AcAB3AHIAcwBjAGgAZQBtAGUALQBhAGMAdAAuAHQAeAB0ACkAIABkAG8AIAAoAA0ACgAgACAAZgBvAHIAIAAvAEYAIAAiAHQAbwBrAGUAbgBzAD0AMgAgAGQAZQBsAGkAbQBzAD0AOgAoACIAIAAlACUAagAgAGkAbgAgACgAJwAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAHAAbwB3AGUAcgBjAGYAZwAuAGUAeABlACAALQBkAHUAcABsAGkAYwBhAHQAZQBzAGMAaABlAG0AZQAgACUAJQBpACcAKQAgAGQAbwAgAGUAYwBoAG8AIAAlACUAagA+ACUAUwB5AHMAdABlAG0AUgBvAG8AdAAlAFwAdwBvAHUAYgBhAGsALQBwAHcAcgBzAGMAaABlAG0AZQAtAHQAZQBtAHAALgB0AHgAdAANAAoAKQANAAoAZgBvAHIAIAAvAEYAIAAlACUAaQAgAGkAbgAgACgAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AdABlAG0AcAAuAHQAeAB0ACkAIABkAG8AIAAoAA0ACgAgACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABTAHkAcwB0AGUAbQAzADIAXABwAG8AdwBlAHIAYwBmAGcALgBlAHgAZQAgAC0AYwBoAGEAbgBnAGUAbgBhAG0AZQAgACUAJQBpACAAVwBPAFUAVABlAG0AcAANAAoAIAAgACUAUwB5AHMAdABlAG0AUgBvAG8AdAAlAFwAUwB5AHMAdABlAG0AMwAyAFwAcABvAHcAZQByAGMAZgBnAC4AZQB4AGUAIAAtAHMAZQB0AGEAYwB2AGEAbAB1AGUAaQBuAGQAZQB4ACAAJQAlAGkAIABzAHUAYgBfAG4AbwBuAGUAIABjAG8AbgBzAG8AbABlAGwAbwBjAGsAIAAwAA0ACgAgACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABTAHkAcwB0AGUAbQAzADIAXABwAG8AdwBlAHIAYwBmAGcALgBlAHgAZQAgAC0AcwBlAHQAZABjAHYAYQBsAHUAZQBpAG4AZABlAHgAIAAlACUAaQAgAHMAdQBiAF8AbgBvAG4AZQAgAGMAbwBuAHMAbwBsAGUAbABvAGMAawAgADAADQAKACAAIAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAHAAbwB3AGUAcgBjAGYAZwAuAGUAeABlACAALQBzAGUAdABhAGMAdABpAHYAZQAgACUAJQBpAA0ACgApAA0ACgBpAGYAIABlAHIAcgBvAHIAbABlAHYAZQBsACAAMQAgACgADQAKACAAIABlAGMAaABvACAAVwBhAHIAbgBpAG4AZwA6ACAAQwByAGUAYQB0AGkAbwBuACAAbwBmACAAdABlAG0AcABvAHIAYQByAHkAIABwAG8AdwBlAHIAIABzAGMAaABlAG0AZQAgAGYAYQBpAGwAZQBkAC4ADQAKACAAIABnAG8AdABvACAAUwBrAGkAcABQAG8AdwBlAHIAQwBmAGcADQAKACkAIABlAGwAcwBlACAAKAANAAoAKQANAAoAZQBjAGgAbwAgAEEAZABqAHUAcwB0AGkAbgBnACAAcABvAHcAZQByACAAbQBhAG4AYQBnAGUAbQBlAG4AdAAgAHMAZQB0AHQAaQBuAGcAcwAuAC4ALgANAAoAZgBvAHIAIAAlACUAaQAgAGkAbgAgACgAZABpAHMAawAgAHMAdABhAG4AZABiAHkAIABoAGkAYgBlAHIAbgBhAHQAZQApACAAZABvACAAKAANAAoAIAAgAGYAbwByACAAJQAlAGoAIABpAG4AIAAoAGEAYwAgAGQAYwApACAAZABvACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABTAHkAcwB0AGUAbQAzADIAXABwAG8AdwBlAHIAYwBmAGcALgBlAHgAZQAgAC0AWAAgAC0AJQAlAGkALQB0AGkAbQBlAG8AdQB0AC0AJQAlAGoAIAAwAA0ACgApAA0ACgBmAG8AcgAgACUAJQBpACAAaQBuACAAKABtAG8AbgBpAHQAbwByACkAIABkAG8AIAAoAA0ACgAgACAAaQBmACAAIgAlAE0ATwBOAEkAVABPAFIAXwBPAE4AJQAiAD0APQAiAC8AbQBvAG4AaQB0AG8AcgBvAG4AIgAgACgADQAKACAAIAAgACAAZgBvAHIAIAAlACUAagAgAGkAbgAgACgAYQBjACAAZABjACkAIABkAG8AIAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAHAAbwB3AGUAcgBjAGYAZwAuAGUAeABlACAALQBYACAALQAlACUAaQAtAHQAaQBtAGUAbwB1AHQALQAlACUAagAgADAADQAKACAAIAApACAAZQBsAHMAZQAgACgADQAKACAAIAAgACAAZgBvAHIAIAAlACUAagAgAGkAbgAgACgAYQBjACAAZABjACkAIABkAG8AIAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAFMAeQBzAHQAZQBtADMAMgBcAHAAbwB3AGUAcgBjAGYAZwAuAGUAeABlACAALQBYACAALQAlACUAaQAtAHQAaQBtAGUAbwB1AHQALQAlACUAagAgADEADQAKACAAIAApAA0ACgApAA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "$scriptspath\powerscheme.cmd" -Value $DecodedText
    }

#generate script - restorepowerscheme cmd
if (Test-Path "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts\restorepowerscheme.cmd"){}
else {
    New-Item -ItemType File -Name "restorepowerscheme.cmd" -Path $scriptspath
    $EncodedText = "aQBmACAAZQB4AGkAcwB0ACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AYQBjAHQALgB0AHgAdAAgACgADQAKACAAIABlAGMAaABvACAAQQBjAHQAaQB2AGEAdABpAG4AZwAgAHAAcgBlAHYAaQBvAHUAcwAgAHAAbwB3AGUAcgAgAHMAYwBoAGUAbQBlAC4ALgAuAA0ACgAgACAAZgBvAHIAIAAvAEYAIAAlACUAaQAgAGkAbgAgACgAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AYQBjAHQALgB0AHgAdAApACAAZABvACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXABTAHkAcwB0AGUAbQAzADIAXABwAG8AdwBlAHIAYwBmAGcALgBlAHgAZQAgAC0AcwBlAHQAYQBjAHQAaQB2AGUAIAAlACUAaQANAAoAIAAgAGkAZgAgAGUAcgByAG8AcgBsAGUAdgBlAGwAIAAxACAAKAANAAoAIAAgACAAIABlAGMAaABvACAAVwBhAHIAbgBpAG4AZwA6ACAAQQBjAHQAaQB2AGEAdABpAG8AbgAgAG8AZgAgAHAAcgBlAHYAaQBvAHUAcwAgAHAAbwB3AGUAcgAgAHMAYwBoAGUAbQBlACAAZgBhAGkAbABlAGQALgANAAoAIAAgACkAIABlAGwAcwBlACAAKAANAAoAIAAgACAAIABkAGUAbAAgACUAUwB5AHMAdABlAG0AUgBvAG8AdAAlAFwAdwBvAHUAYgBhAGsALQBwAHcAcgBzAGMAaABlAG0AZQAtAGEAYwB0AC4AdAB4AHQADQAKACAAIAApAA0ACgApAA0ACgBpAGYAIABlAHgAaQBzAHQAIAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHcAbwB1AGIAYQBrAC0AcAB3AHIAcwBjAGgAZQBtAGUALQB0AGUAbQBwAC4AdAB4AHQAIAAoAA0ACgAgACAAZQBjAGgAbwAgAEQAZQBsAGUAdABpAG4AZwAgAHQAZQBtAHAAbwByAGEAcgB5ACAAcABvAHcAZQByACAAcwBjAGgAZQBtAGUALgAuAC4ADQAKACAAIABmAG8AcgAgAC8ARgAgACUAJQBpACAAaQBuACAAKAAlAFMAeQBzAHQAZQBtAFIAbwBvAHQAJQBcAHcAbwB1AGIAYQBrAC0AcAB3AHIAcwBjAGgAZQBtAGUALQB0AGUAbQBwAC4AdAB4AHQAKQAgAGQAbwAgACUAUwB5AHMAdABlAG0AUgBvAG8AdAAlAFwAUwB5AHMAdABlAG0AMwAyAFwAcABvAHcAZQByAGMAZgBnAC4AZQB4AGUAIAAtAGQAZQBsAGUAdABlACAAJQAlAGkADQAKACAAIABpAGYAIABlAHIAcgBvAHIAbABlAHYAZQBsACAAMQAgACgADQAKACAAIAAgACAAZQBjAGgAbwAgAFcAYQByAG4AaQBuAGcAOgAgAEQAZQBsAGUAdABpAG8AbgAgAG8AZgAgAHQAZQBtAHAAbwByAGEAcgB5ACAAcABvAHcAZQByACAAcwBjAGgAZQBtAGUAIABmAGEAaQBsAGUAZAAuAA0ACgAgACAAKQAgAGUAbABzAGUAIAAoAA0ACgAgACAAIAAgAGQAZQBsACAAJQBTAHkAcwB0AGUAbQBSAG8AbwB0ACUAXAB3AG8AdQBiAGEAawAtAHAAdwByAHMAYwBoAGUAbQBlAC0AdABlAG0AcAAuAHQAeAB0AA0ACgAgACAAKQANAAoAKQA="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "$scriptspath\restorepowerscheme.cmd" -Value $DecodedText
    }

#generate scheduled task - bypass xml
if (Test-Path "C:\temp\bypass.xml"){}
else {
    New-Item -ItemType File -Name "bypass.xml" -Path "c:\temp"
    $EncodedText = "PAA/AHgAbQBsACAAdgBlAHIAcwBpAG8AbgA9ACIAMQAuADAAIgAgAGUAbgBjAG8AZABpAG4AZwA9ACIAVQBUAEYALQAxADYAIgA/AD4ADQAKADwAVABhAHMAawAgAHYAZQByAHMAaQBvAG4APQAiADEALgAyACIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AcwBjAGgAZQBtAGEAcwAuAG0AaQBjAHIAbwBzAG8AZgB0AC4AYwBvAG0ALwB3AGkAbgBkAG8AdwBzAC8AMgAwADAANAAvADAAMgAvAG0AaQB0AC8AdABhAHMAawAiAD4ADQAKACAAIAA8AFIAZQBnAGkAcwB0AHIAYQB0AGkAbwBuAEkAbgBmAG8APgANAAoAIAAgACAAIAA8AEQAYQB0AGUAPgAyADAAMgAwAC0AMAA5AC0AMQAxAFQAMQA1ADoAMQAxADoAMgAwAC4AMwA1ADMAMAAwADYAOQA8AC8ARABhAHQAZQA+AA0ACgAgACAAIAAgADwAQQB1AHQAaABvAHIAPgBNAEkATgBJAE4AVAAtAFQARQBLAEUAMwAwADkAXABJAFQATwBwAHMAPAAvAEEAdQB0AGgAbwByAD4ADQAKACAAIAAgACAAPABVAFIASQA+AFwAQgB5AHAAYQBzAHMAPAAvAFUAUgBJAD4ADQAKACAAIAA8AC8AUgBlAGcAaQBzAHQAcgBhAHQAaQBvAG4ASQBuAGYAbwA+AA0ACgAgACAAPABUAHIAaQBnAGcAZQByAHMAPgANAAoAIAAgACAAIAA8AEUAdgBlAG4AdABUAHIAaQBnAGcAZQByAD4ADQAKACAAIAAgACAAIAAgADwARQBuAGEAYgBsAGUAZAA+AHQAcgB1AGUAPAAvAEUAbgBhAGIAbABlAGQAPgANAAoAIAAgACAAIAAgACAAPABTAHUAYgBzAGMAcgBpAHAAdABpAG8AbgA+ACYAbAB0ADsAUQB1AGUAcgB5AEwAaQBzAHQAJgBnAHQAOwAmAGwAdAA7AFEAdQBlAHIAeQAgAEkAZAA9ACIAMAAiACAAUABhAHQAaAA9ACIAQQBwAHAAbABpAGMAYQB0AGkAbwBuACIAJgBnAHQAOwAmAGwAdAA7AFMAZQBsAGUAYwB0ACAAUABhAHQAaAA9ACIAQQBwAHAAbABpAGMAYQB0AGkAbwBuACIAJgBnAHQAOwAqAFsAUwB5AHMAdABlAG0AWwBQAHIAbwB2AGkAZABlAHIAWwBAAE4AYQBtAGUAPQAnAE4AWQBVAEEARABXADEAMABVAHAAJwBdACAAYQBuAGQAIABFAHYAZQBuAHQASQBEAD0AMQBdAF0AJgBsAHQAOwAvAFMAZQBsAGUAYwB0ACYAZwB0ADsAJgBsAHQAOwAvAFEAdQBlAHIAeQAmAGcAdAA7ACYAbAB0ADsALwBRAHUAZQByAHkATABpAHMAdAAmAGcAdAA7ADwALwBTAHUAYgBzAGMAcgBpAHAAdABpAG8AbgA+AA0ACgAgACAAIAAgADwALwBFAHYAZQBuAHQAVAByAGkAZwBnAGUAcgA+AA0ACgAgACAAPAAvAFQAcgBpAGcAZwBlAHIAcwA+AA0ACgAgACAAPABQAHIAaQBuAGMAaQBwAGEAbABzAD4ADQAKACAAIAAgACAAPABQAHIAaQBuAGMAaQBwAGEAbAAgAGkAZAA9ACIAQQB1AHQAaABvAHIAIgA+AA0ACgAgACAAIAAgACAAIAA8AFUAcwBlAHIASQBkAD4AUwAtADEALQA1AC0AMQA4ADwALwBVAHMAZQByAEkAZAA+AA0ACgAgACAAIAAgACAAIAA8AFIAdQBuAEwAZQB2AGUAbAA+AEwAZQBhAHMAdABQAHIAaQB2AGkAbABlAGcAZQA8AC8AUgB1AG4ATABlAHYAZQBsAD4ADQAKACAAIAAgACAAPAAvAFAAcgBpAG4AYwBpAHAAYQBsAD4ADQAKACAAIAA8AC8AUAByAGkAbgBjAGkAcABhAGwAcwA+AA0ACgAgACAAPABTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgACAAIAA8AE0AdQBsAHQAaQBwAGwAZQBJAG4AcwB0AGEAbgBjAGUAcwBQAG8AbABpAGMAeQA+AEkAZwBuAG8AcgBlAE4AZQB3ADwALwBNAHUAbAB0AGkAcABsAGUASQBuAHMAdABhAG4AYwBlAHMAUABvAGwAaQBjAHkAPgANAAoAIAAgACAAIAA8AEQAaQBzAGEAbABsAG8AdwBTAHQAYQByAHQASQBmAE8AbgBCAGEAdAB0AGUAcgBpAGUAcwA+AHQAcgB1AGUAPAAvAEQAaQBzAGEAbABsAG8AdwBTAHQAYQByAHQASQBmAE8AbgBCAGEAdAB0AGUAcgBpAGUAcwA+AA0ACgAgACAAIAAgADwAUwB0AG8AcABJAGYARwBvAGkAbgBnAE8AbgBCAGEAdAB0AGUAcgBpAGUAcwA+AHQAcgB1AGUAPAAvAFMAdABvAHAASQBmAEcAbwBpAG4AZwBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgANAAoAIAAgACAAIAA8AEEAbABsAG8AdwBIAGEAcgBkAFQAZQByAG0AaQBuAGEAdABlAD4AdAByAHUAZQA8AC8AQQBsAGwAbwB3AEgAYQByAGQAVABlAHIAbQBpAG4AYQB0AGUAPgANAAoAIAAgACAAIAA8AFMAdABhAHIAdABXAGgAZQBuAEEAdgBhAGkAbABhAGIAbABlAD4AZgBhAGwAcwBlADwALwBTAHQAYQByAHQAVwBoAGUAbgBBAHYAYQBpAGwAYQBiAGwAZQA+AA0ACgAgACAAIAAgADwAUgB1AG4ATwBuAGwAeQBJAGYATgBlAHQAdwBvAHIAawBBAHYAYQBpAGwAYQBiAGwAZQA+AGYAYQBsAHMAZQA8AC8AUgB1AG4ATwBuAGwAeQBJAGYATgBlAHQAdwBvAHIAawBBAHYAYQBpAGwAYQBiAGwAZQA+AA0ACgAgACAAIAAgADwASQBkAGwAZQBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgACAAIAAgACAAPABTAHQAbwBwAE8AbgBJAGQAbABlAEUAbgBkAD4AdAByAHUAZQA8AC8AUwB0AG8AcABPAG4ASQBkAGwAZQBFAG4AZAA+AA0ACgAgACAAIAAgACAAIAA8AFIAZQBzAHQAYQByAHQATwBuAEkAZABsAGUAPgBmAGEAbABzAGUAPAAvAFIAZQBzAHQAYQByAHQATwBuAEkAZABsAGUAPgANAAoAIAAgACAAIAA8AC8ASQBkAGwAZQBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgACAAIAA8AEEAbABsAG8AdwBTAHQAYQByAHQATwBuAEQAZQBtAGEAbgBkAD4AdAByAHUAZQA8AC8AQQBsAGwAbwB3AFMAdABhAHIAdABPAG4ARABlAG0AYQBuAGQAPgANAAoAIAAgACAAIAA8AEUAbgBhAGIAbABlAGQAPgB0AHIAdQBlADwALwBFAG4AYQBiAGwAZQBkAD4ADQAKACAAIAAgACAAPABIAGkAZABkAGUAbgA+AGYAYQBsAHMAZQA8AC8ASABpAGQAZABlAG4APgANAAoAIAAgACAAIAA8AFIAdQBuAE8AbgBsAHkASQBmAEkAZABsAGUAPgBmAGEAbABzAGUAPAAvAFIAdQBuAE8AbgBsAHkASQBmAEkAZABsAGUAPgANAAoAIAAgACAAIAA8AFcAYQBrAGUAVABvAFIAdQBuAD4AZgBhAGwAcwBlADwALwBXAGEAawBlAFQAbwBSAHUAbgA+AA0ACgAgACAAIAAgADwARQB4AGUAYwB1AHQAaQBvAG4AVABpAG0AZQBMAGkAbQBpAHQAPgBQAFQANwAyAEgAPAAvAEUAeABlAGMAdQB0AGkAbwBuAFQAaQBtAGUATABpAG0AaQB0AD4ADQAKACAAIAAgACAAPABQAHIAaQBvAHIAaQB0AHkAPgA3ADwALwBQAHIAaQBvAHIAaQB0AHkAPgANAAoAIAAgADwALwBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgADwAQQBjAHQAaQBvAG4AcwAgAEMAbwBuAHQAZQB4AHQAPQAiAEEAdQB0AGgAbwByACIAPgANAAoAIAAgACAAIAA8AEUAeABlAGMAPgANAAoAIAAgACAAIAAgACAAPABDAG8AbQBtAGEAbgBkAD4AcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlADwALwBDAG8AbQBtAGEAbgBkAD4ADQAKACAAIAAgACAAIAAgADwAQQByAGcAdQBtAGUAbgB0AHMAPgAtAGUAeABlAGMAdQB0AGkAbwBuAHAAbwBsAGkAYwB5ACAAYgB5AHAAYQBzAHMAIAAtAHcAaQBuAGQAbwB3AHMAdAB5AGwAZQAgAGgAaQBkAGQAZQBuACAALQBuAG8AbgBpAG4AdABlAHIAYQBjAHQAaQB2AGUAIAAtAG4AbwBsAG8AZwBvACAALQBmAGkAbABlACAAIgBjADoAXAB0AGUAbQBwAFwAYgB5AHAAYQBzAHMALgBwAHMAMQAiADwALwBBAHIAZwB1AG0AZQBuAHQAcwA+AA0ACgAgACAAIAAgADwALwBFAHgAZQBjAD4ADQAKACAAIAA8AC8AQQBjAHQAaQBvAG4AcwA+AA0ACgA8AC8AVABhAHMAawA+AA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "c:\temp\bypass.xml" -Value $DecodedText
    }
#generate scheduled task - post upgrade xml
if (Test-Path "C:\temp\Post-upgrade.xml"){}
else {
    New-Item -ItemType File -Name "post-upgrade.xml" -Path "c:\temp"
    $EncodedText = "PAA/AHgAbQBsACAAdgBlAHIAcwBpAG8AbgA9ACIAMQAuADAAIgAgAGUAbgBjAG8AZABpAG4AZwA9ACIAVQBUAEYALQAxADYAIgA/AD4ADQAKADwAVABhAHMAawAgAHYAZQByAHMAaQBvAG4APQAiADEALgAyACIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AcwBjAGgAZQBtAGEAcwAuAG0AaQBjAHIAbwBzAG8AZgB0AC4AYwBvAG0ALwB3AGkAbgBkAG8AdwBzAC8AMgAwADAANAAvADAAMgAvAG0AaQB0AC8AdABhAHMAawAiAD4ADQAKACAAIAA8AFIAZQBnAGkAcwB0AHIAYQB0AGkAbwBuAEkAbgBmAG8APgANAAoAIAAgACAAIAA8AEQAYQB0AGUAPgAyADAAMgAwAC0AMAA5AC0AMQA0AFQAMQA2ADoANAA1ADoAMAA4AC4AMQA5ADYAMgAxADEAMwA8AC8ARABhAHQAZQA+AA0ACgAgACAAIAAgADwAQQB1AHQAaABvAHIAPgBNAEkATgBJAE4AVAAtAFQARQBLAEUAMwAwADkAXABJAFQATwBwAHMAPAAvAEEAdQB0AGgAbwByAD4ADQAKACAAIAAgACAAPABVAFIASQA+AFwAVwBpAG4AZABvAHcAcwAxADAAVQBwAGcAcgBhAGQAZQBcAFAAbwBzAHQALQB1AHAAZwByAGEAZABlADwALwBVAFIASQA+AA0ACgAgACAAPAAvAFIAZQBnAGkAcwB0AHIAYQB0AGkAbwBuAEkAbgBmAG8APgANAAoAIAAgADwAVAByAGkAZwBnAGUAcgBzAD4ADQAKACAAIAAgACAAPABCAG8AbwB0AFQAcgBpAGcAZwBlAHIAPgANAAoAIAAgACAAIAAgACAAPABFAG4AYQBiAGwAZQBkAD4AdAByAHUAZQA8AC8ARQBuAGEAYgBsAGUAZAA+AA0ACgAgACAAIAAgADwALwBCAG8AbwB0AFQAcgBpAGcAZwBlAHIAPgANAAoAIAAgADwALwBUAHIAaQBnAGcAZQByAHMAPgANAAoAIAAgADwAUAByAGkAbgBjAGkAcABhAGwAcwA+AA0ACgAgACAAIAAgADwAUAByAGkAbgBjAGkAcABhAGwAIABpAGQAPQAiAEEAdQB0AGgAbwByACIAPgANAAoAIAAgACAAIAAgACAAPABVAHMAZQByAEkAZAA+AFMALQAxAC0ANQAtADEAOAA8AC8AVQBzAGUAcgBJAGQAPgANAAoAIAAgACAAIAAgACAAPABSAHUAbgBMAGUAdgBlAGwAPgBMAGUAYQBzAHQAUAByAGkAdgBpAGwAZQBnAGUAPAAvAFIAdQBuAEwAZQB2AGUAbAA+AA0ACgAgACAAIAAgADwALwBQAHIAaQBuAGMAaQBwAGEAbAA+AA0ACgAgACAAPAAvAFAAcgBpAG4AYwBpAHAAYQBsAHMAPgANAAoAIAAgADwAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAPABNAHUAbAB0AGkAcABsAGUASQBuAHMAdABhAG4AYwBlAHMAUABvAGwAaQBjAHkAPgBJAGcAbgBvAHIAZQBOAGUAdwA8AC8ATQB1AGwAdABpAHAAbABlAEkAbgBzAHQAYQBuAGMAZQBzAFAAbwBsAGkAYwB5AD4ADQAKACAAIAAgACAAPABEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AEkAZgBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgB0AHIAdQBlADwALwBEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AEkAZgBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgANAAoAIAAgACAAIAA8AFMAdABvAHAASQBmAEcAbwBpAG4AZwBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgB0AHIAdQBlADwALwBTAHQAbwBwAEkAZgBHAG8AaQBuAGcATwBuAEIAYQB0AHQAZQByAGkAZQBzAD4ADQAKACAAIAAgACAAPABBAGwAbABvAHcASABhAHIAZABUAGUAcgBtAGkAbgBhAHQAZQA+AHQAcgB1AGUAPAAvAEEAbABsAG8AdwBIAGEAcgBkAFQAZQByAG0AaQBuAGEAdABlAD4ADQAKACAAIAAgACAAPABTAHQAYQByAHQAVwBoAGUAbgBBAHYAYQBpAGwAYQBiAGwAZQA+AGYAYQBsAHMAZQA8AC8AUwB0AGEAcgB0AFcAaABlAG4AQQB2AGEAaQBsAGEAYgBsAGUAPgANAAoAIAAgACAAIAA8AFIAdQBuAE8AbgBsAHkASQBmAE4AZQB0AHcAbwByAGsAQQB2AGEAaQBsAGEAYgBsAGUAPgBmAGEAbABzAGUAPAAvAFIAdQBuAE8AbgBsAHkASQBmAE4AZQB0AHcAbwByAGsAQQB2AGEAaQBsAGEAYgBsAGUAPgANAAoAIAAgACAAIAA8AEkAZABsAGUAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAIAAgADwAUwB0AG8AcABPAG4ASQBkAGwAZQBFAG4AZAA+AHQAcgB1AGUAPAAvAFMAdABvAHAATwBuAEkAZABsAGUARQBuAGQAPgANAAoAIAAgACAAIAAgACAAPABSAGUAcwB0AGEAcgB0AE8AbgBJAGQAbABlAD4AZgBhAGwAcwBlADwALwBSAGUAcwB0AGEAcgB0AE8AbgBJAGQAbABlAD4ADQAKACAAIAAgACAAPAAvAEkAZABsAGUAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAPABBAGwAbABvAHcAUwB0AGEAcgB0AE8AbgBEAGUAbQBhAG4AZAA+AHQAcgB1AGUAPAAvAEEAbABsAG8AdwBTAHQAYQByAHQATwBuAEQAZQBtAGEAbgBkAD4ADQAKACAAIAAgACAAPABFAG4AYQBiAGwAZQBkAD4AdAByAHUAZQA8AC8ARQBuAGEAYgBsAGUAZAA+AA0ACgAgACAAIAAgADwASABpAGQAZABlAG4APgBmAGEAbABzAGUAPAAvAEgAaQBkAGQAZQBuAD4ADQAKACAAIAAgACAAPABSAHUAbgBPAG4AbAB5AEkAZgBJAGQAbABlAD4AZgBhAGwAcwBlADwALwBSAHUAbgBPAG4AbAB5AEkAZgBJAGQAbABlAD4ADQAKACAAIAAgACAAPABXAGEAawBlAFQAbwBSAHUAbgA+AGYAYQBsAHMAZQA8AC8AVwBhAGsAZQBUAG8AUgB1AG4APgANAAoAIAAgACAAIAA8AEUAeABlAGMAdQB0AGkAbwBuAFQAaQBtAGUATABpAG0AaQB0AD4AUABUADcAMgBIADwALwBFAHgAZQBjAHUAdABpAG8AbgBUAGkAbQBlAEwAaQBtAGkAdAA+AA0ACgAgACAAIAAgADwAUAByAGkAbwByAGkAdAB5AD4ANwA8AC8AUAByAGkAbwByAGkAdAB5AD4ADQAKACAAIAA8AC8AUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAA8AEEAYwB0AGkAbwBuAHMAIABDAG8AbgB0AGUAeAB0AD0AIgBBAHUAdABoAG8AcgAiAD4ADQAKACAAIAAgACAAPABFAHgAZQBjAD4ADQAKACAAIAAgACAAIAAgADwAQwBvAG0AbQBhAG4AZAA+AHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQA8AC8AQwBvAG0AbQBhAG4AZAA+AA0ACgAgACAAIAAgACAAIAA8AEEAcgBnAHUAbQBlAG4AdABzAD4ALQBlAHgAZQBjAHUAdABpAG8AbgBwAG8AbABpAGMAeQAgAGIAeQBwAGEAcwBzACAALQB3AGkAbgBkAG8AdwBzAHQAeQBsAGUAIABoAGkAZABkAGUAbgAgAC0AbgBvAG4AaQBuAHQAZQByAGEAYwB0AGkAdgBlACAALQBuAG8AbABvAGcAbwAgAC0AZgBpAGwAZQAgACIAQwA6AFwAdABlAG0AcABcAFAAZQByAGYAbwByAG0AVQBuAGkAbgBzAHQAYQBsAGwALgBwAHMAMQAiADwALwBBAHIAZwB1AG0AZQBuAHQAcwA+AA0ACgAgACAAIAAgADwALwBFAHgAZQBjAD4ADQAKACAAIAA8AC8AQQBjAHQAaQBvAG4AcwA+AA0ACgA8AC8AVABhAHMAawA+AA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "c:\temp\Post-upgrade.xml" -Value $DecodedText
    }
#generate scheduled task - Launcher xml
if (Test-Path "C:\temp\LaunchMe.xml"){}
else {
    New-Item -ItemType File -Name "LaunchMe.xml" -Path "c:\temp"
    $EncodedText = "PAA/AHgAbQBsACAAdgBlAHIAcwBpAG8AbgA9ACIAMQAuADAAIgAgAGUAbgBjAG8AZABpAG4AZwA9ACIAVQBUAEYALQAxADYAIgA/AD4ADQAKADwAVABhAHMAawAgAHYAZQByAHMAaQBvAG4APQAiADEALgA0ACIAIAB4AG0AbABuAHMAPQAiAGgAdAB0AHAAOgAvAC8AcwBjAGgAZQBtAGEAcwAuAG0AaQBjAHIAbwBzAG8AZgB0AC4AYwBvAG0ALwB3AGkAbgBkAG8AdwBzAC8AMgAwADAANAAvADAAMgAvAG0AaQB0AC8AdABhAHMAawAiAD4ADQAKACAAIAA8AFIAZQBnAGkAcwB0AHIAYQB0AGkAbwBuAEkAbgBmAG8APgANAAoAIAAgACAAIAA8AEQAYQB0AGUAPgAyADAAMgAxAC0AMAAyAC0AMQA0AFQAMAA1ADoAMAAxADoANQAxAC4ANQAzADUAMQA5ADAANAA8AC8ARABhAHQAZQA+AA0ACgAgACAAIAAgADwAQQB1AHQAaABvAHIAPgBBAEQAXABtAGEAcgBpAGEAbgBvAGMAPAAvAEEAdQB0AGgAbwByAD4ADQAKACAAIAAgACAAPABVAFIASQA+AFwAVwBpAG4AZABvAHcAcwAxADAAVQBwAGcAcgBhAGQAZQBcAEwAYQB1AG4AYwBoAE0AZQA8AC8AVQBSAEkAPgANAAoAIAAgADwALwBSAGUAZwBpAHMAdAByAGEAdABpAG8AbgBJAG4AZgBvAD4ADQAKACAAIAA8AFQAcgBpAGcAZwBlAHIAcwAgAC8APgANAAoAIAAgADwAUAByAGkAbgBjAGkAcABhAGwAcwA+AA0ACgAgACAAIAAgADwAUAByAGkAbgBjAGkAcABhAGwAIABpAGQAPQAiAEEAdQB0AGgAbwByACIAPgANAAoAIAAgACAAIAAgACAAPABHAHIAbwB1AHAASQBkAD4AUwAtADEALQA1AC0AMwAyAC0ANQA0ADUAPAAvAEcAcgBvAHUAcABJAGQAPgANAAoAIAAgACAAIAAgACAAPABSAHUAbgBMAGUAdgBlAGwAPgBMAGUAYQBzAHQAUAByAGkAdgBpAGwAZQBnAGUAPAAvAFIAdQBuAEwAZQB2AGUAbAA+AA0ACgAgACAAIAAgADwALwBQAHIAaQBuAGMAaQBwAGEAbAA+AA0ACgAgACAAPAAvAFAAcgBpAG4AYwBpAHAAYQBsAHMAPgANAAoAIAAgADwAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAPABNAHUAbAB0AGkAcABsAGUASQBuAHMAdABhAG4AYwBlAHMAUABvAGwAaQBjAHkAPgBJAGcAbgBvAHIAZQBOAGUAdwA8AC8ATQB1AGwAdABpAHAAbABlAEkAbgBzAHQAYQBuAGMAZQBzAFAAbwBsAGkAYwB5AD4ADQAKACAAIAAgACAAPABEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AEkAZgBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgB0AHIAdQBlADwALwBEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AEkAZgBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgANAAoAIAAgACAAIAA8AFMAdABvAHAASQBmAEcAbwBpAG4AZwBPAG4AQgBhAHQAdABlAHIAaQBlAHMAPgB0AHIAdQBlADwALwBTAHQAbwBwAEkAZgBHAG8AaQBuAGcATwBuAEIAYQB0AHQAZQByAGkAZQBzAD4ADQAKACAAIAAgACAAPABBAGwAbABvAHcASABhAHIAZABUAGUAcgBtAGkAbgBhAHQAZQA+AHQAcgB1AGUAPAAvAEEAbABsAG8AdwBIAGEAcgBkAFQAZQByAG0AaQBuAGEAdABlAD4ADQAKACAAIAAgACAAPABTAHQAYQByAHQAVwBoAGUAbgBBAHYAYQBpAGwAYQBiAGwAZQA+AGYAYQBsAHMAZQA8AC8AUwB0AGEAcgB0AFcAaABlAG4AQQB2AGEAaQBsAGEAYgBsAGUAPgANAAoAIAAgACAAIAA8AFIAdQBuAE8AbgBsAHkASQBmAE4AZQB0AHcAbwByAGsAQQB2AGEAaQBsAGEAYgBsAGUAPgBmAGEAbABzAGUAPAAvAFIAdQBuAE8AbgBsAHkASQBmAE4AZQB0AHcAbwByAGsAQQB2AGEAaQBsAGEAYgBsAGUAPgANAAoAIAAgACAAIAA8AEkAZABsAGUAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAIAAgADwAUwB0AG8AcABPAG4ASQBkAGwAZQBFAG4AZAA+AHQAcgB1AGUAPAAvAFMAdABvAHAATwBuAEkAZABsAGUARQBuAGQAPgANAAoAIAAgACAAIAAgACAAPABSAGUAcwB0AGEAcgB0AE8AbgBJAGQAbABlAD4AZgBhAGwAcwBlADwALwBSAGUAcwB0AGEAcgB0AE8AbgBJAGQAbABlAD4ADQAKACAAIAAgACAAPAAvAEkAZABsAGUAUwBlAHQAdABpAG4AZwBzAD4ADQAKACAAIAAgACAAPABBAGwAbABvAHcAUwB0AGEAcgB0AE8AbgBEAGUAbQBhAG4AZAA+AHQAcgB1AGUAPAAvAEEAbABsAG8AdwBTAHQAYQByAHQATwBuAEQAZQBtAGEAbgBkAD4ADQAKACAAIAAgACAAPABFAG4AYQBiAGwAZQBkAD4AdAByAHUAZQA8AC8ARQBuAGEAYgBsAGUAZAA+AA0ACgAgACAAIAAgADwASABpAGQAZABlAG4APgBmAGEAbABzAGUAPAAvAEgAaQBkAGQAZQBuAD4ADQAKACAAIAAgACAAPABSAHUAbgBPAG4AbAB5AEkAZgBJAGQAbABlAD4AZgBhAGwAcwBlADwALwBSAHUAbgBPAG4AbAB5AEkAZgBJAGQAbABlAD4ADQAKACAAIAAgACAAPABEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AE8AbgBSAGUAbQBvAHQAZQBBAHAAcABTAGUAcwBzAGkAbwBuAD4AZgBhAGwAcwBlADwALwBEAGkAcwBhAGwAbABvAHcAUwB0AGEAcgB0AE8AbgBSAGUAbQBvAHQAZQBBAHAAcABTAGUAcwBzAGkAbwBuAD4ADQAKACAAIAAgACAAPABVAHMAZQBVAG4AaQBmAGkAZQBkAFMAYwBoAGUAZAB1AGwAaQBuAGcARQBuAGcAaQBuAGUAPgB0AHIAdQBlADwALwBVAHMAZQBVAG4AaQBmAGkAZQBkAFMAYwBoAGUAZAB1AGwAaQBuAGcARQBuAGcAaQBuAGUAPgANAAoAIAAgACAAIAA8AFcAYQBrAGUAVABvAFIAdQBuAD4AZgBhAGwAcwBlADwALwBXAGEAawBlAFQAbwBSAHUAbgA+AA0ACgAgACAAIAAgADwARQB4AGUAYwB1AHQAaQBvAG4AVABpAG0AZQBMAGkAbQBpAHQAPgBQAFQANwAyAEgAPAAvAEUAeABlAGMAdQB0AGkAbwBuAFQAaQBtAGUATABpAG0AaQB0AD4ADQAKACAAIAAgACAAPABQAHIAaQBvAHIAaQB0AHkAPgA3ADwALwBQAHIAaQBvAHIAaQB0AHkAPgANAAoAIAAgADwALwBTAGUAdAB0AGkAbgBnAHMAPgANAAoAIAAgADwAQQBjAHQAaQBvAG4AcwAgAEMAbwBuAHQAZQB4AHQAPQAiAEEAdQB0AGgAbwByACIAPgANAAoAIAAgACAAIAA8AEUAeABlAGMAPgANAAoAIAAgACAAIAAgACAAPABDAG8AbQBtAGEAbgBkAD4AIgBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABsAGEAdQBuAGMAaABlAHIAXABOAFkAVQBBAEQAIABXAGkAbgBkAG8AdwBzACAAMQAwACAAVQBwAGcAcgBhAGQAZQAuAGUAeABlACIAPAAvAEMAbwBtAG0AYQBuAGQAPgANAAoAIAAgACAAIAA8AC8ARQB4AGUAYwA+AA0ACgAgACAAPAAvAEEAYwB0AGkAbwBuAHMAPgANAAoAPAAvAFQAYQBzAGsAPgA="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "c:\temp\LaunchMe.xml" -Value $DecodedText
    }

    #generate scheduled task - CutMe ps1
if (Test-Path "C:\temp\CutMe.ps1"){}
else {
    New-Item -ItemType File -Name "CutMe.ps1" -Path "c:\temp"
    $EncodedText = "PAAjAAoAUwBjAHIAaQBwAHQAIABOAGEAbQBlADoAIABDAHUAdABNAGUALgBwAHMAMQAKAFYAZQByAHMAaQBvAG4AOgAgADEACgBEAGUAcwBjAHIAaQBwAHQAaQBvAG4AOgAgAEMAbABlAGEAbgAgAEEAVgAgAGkAbgBzAHQAYQBsAGwAYQB0AGkAbwBuACAAdABvACAAYwB1AHIAcgByAGUAbgB0ACAAdgBlAHIAcwBpAG8AbgAKAEEAdQB0AGgAbwByADoAIAB4AHQAaQBhAG4AQABkAHgAYwAuAGMAbwBtAAoAIwA+AAoACgBTAGUAdAAtAEwAbwBjAGEAdABpAG8AbgAgACIAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlACIACgAkAGMAbQBkAHAAYQB0AGgAIAA9ACAAJwBjADoAXAB3AGkAbgBkAG8AdwBzAFwAcwB5AHMAdABlAG0AMwAyAFwAYwBtAGQALgBlAHgAZQAgAC8AYwAgACcACgAkAEEAcABlAHgAUABhAHQAaAA9ACIAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwAgACgAeAA4ADYAKQBcAFQAcgBlAG4AZAAgAE0AaQBjAHIAbwBcAE8AZgBmAGkAYwBlAFMAYwBhAG4AIABDAGwAaQBlAG4AdABcAFAAYwBjAE4AVABNAG8AbgAuAGUAeABlACIACgAkAEEAcABlAHgAUwB0AGEAdABlACAAPQAgACIAcABlAG4AZABpAG4AZwAiAAoACgAjAGQAaQBzAGEAYgBsAGUAIABwAG8AdwBlAHIAIABzAGEAdgBpAG4AZwBzACAAbQBvAGQAZQBzAAoASQBuAHYAbwBrAGUALQBFAHgAcAByAGUAcwBzAGkAbwBuACAAIgAkAGMAbQBkAHAAYQB0AGgALgBcAHMAYwByAGkAcAB0AHMAXABwAG8AdwBlAHIAcwBjAGgAZQBtAGUALgBjAG0AZAAgAGkAbgBpAHQALgBjAG0AZAAiACAACgAKACMAQwB1AHQAIABBAHAAZQB4ACAAaQBmACAAbgBlAGUAZABlAGQACgBJAGYAIAAoAFQAZQBzAHQALQBQAGEAdABoACAAJABBAHAAZQB4AFAAYQB0AGgAKQAgAHsACgAgACAAIAAgACQAQQBwAGUAeABWAGUAcgBzAGkAbwBuAD0AKABHAGUAdAAtAEMAaABpAGwAZABJAHQAZQBtACAAIgBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzACAAKAB4ADgANgApAFwAVAByAGUAbgBkACAATQBpAGMAcgBvAFwATwBmAGYAaQBjAGUAUwBjAGEAbgAgAEMAbABpAGUAbgB0AFwAUABjAGMATgBUAE0AbwBuAC4AZQB4AGUAIgApAC4AVgBlAHIAcwBpAG8AbgBJAG4AZgBvAC4ARgBpAGwAZQBWAGUAcgBzAGkAbwBuAAoAIAAgACAAIAAjACQAQQBwAGUAeABWAGUAcgBzAGkAbwBuACAAPQAgADEAMwAKACAAIAAgACAASQBmACAAKAAkAEEAcABlAHgAVgBlAHIAcwBpAG8AbgAgAC0AZwBlACAAMQA0AC4AMAAuADAALgA5ADcAMgAyACkAIAB7AAoAIAAgACAAIAAkAEEAcABlAHgAUwB0AGEAdABlACAAPQAgACIAUgBlAGEAZAB5ACIACgAgACAAIAAgAH0ACgAgACAAIAAgAGUAbABzAGUAIAB7AAoAIAAgACAAIAAkADcAWgBpAHAAUABhAHQAaAAgAD0AIAAiACcAQwA6AFwAUAByAG8AZwByAGEAbQAgAEYAaQBsAGUAcwBcAE4AWQBVAEEARAAgAEkAVABcAFcAaQBuAGQAbwB3AHMAIAAxADAAIAB1AHAAZwByAGEAZABlAFwANwB6AGEAOQAyADAAXAA3AHoAYQAuAGUAeABlACcAIgAKACAAIAAgACAAJAB6AGkAcABGAGkAbABlACAAPQAgACIAJwBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABkAGEAdABhAFwAcwBjAHUAdABfADEALgAwAC4AMAAuAHoAaQBwACcAIgAKACAAIAAgACAAJABjAHUAdABkAGUAcwB0ACAAPQAgACIAJwBDADoAXABQAHIAbwBnAHIAYQBtACAARgBpAGwAZQBzAFwATgBZAFUAQQBEACAASQBUAFwAVwBpAG4AZABvAHcAcwAgADEAMAAgAHUAcABnAHIAYQBkAGUAXABjAHUAdAAnACIACgAgACAAIAAgACQARABlAGMAbwBkAGUAZAAgAD0AIABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAG4AaQBjAG8AZABlAC4ARwBlAHQAUwB0AHIAaQBuAGcAKABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAJwBkAEEAQgB5AEEARwBVAEEAYgBnAEIAawBBAEEAPQA9ACcAKQApAAoAIAAgACAAIAAkAGMAdQB0AGMAbwBtAG0AYQBuAGQAIAA9ACAAIgAmACAAJAA3AFoAaQBwAFAAYQB0AGgAIABlACAALQBvACQAYwB1AHQAZABlAHMAdAAgAC0AeQAgAC0AdAB6AGkAcAAgAC0AcAAkAEQAZQBjAG8AZABlAGQAIAAkAHoAaQBwAEYAaQBsAGUAIgAKACAAIAAgACAAaQBlAHgAIAAkAGMAdQB0AGMAbwBtAG0AYQBuAGQACgAgACAAIAAgACQAYwB1AHQAYwBvAG0AbQBhAG4AZAAgAD0AIAAiACYAIAAnAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAXABOAFkAVQBBAEQAIABJAFQAXABXAGkAbgBkAG8AdwBzACAAMQAwACAAdQBwAGcAcgBhAGQAZQBcAGMAdQB0AFwAcwBjAHUAdAAuAGUAeABlACcAIAAtAG4AbwBpAG4AcwB0AGEAbABsACIACgAgACAAIAAgAGkAZQB4ACAAJABjAHUAdABjAG8AbQBtAGEAbgBkAAoAIAAgACAAIAAkAEEAcABlAHgAUwB0AGEAdABlACAAPQAgACIAUABlAG4AZABpAG4AZwAiAAoAIAAgACAAIAB9AAoAIAAgACAAIAB9AAoACgAKACMAVwBhAGkAdAAgAGYAbwByACAAQwB1AHQAIABQAHIAbwBjAGUAcwBzACAAdABvACAAYwBvAG0AcABsAGUAdABlAAoAZABvAHsACgAgACAAIAAgACQAUAByAG8AYwAgAD0AIABHAGUAdAAtAFAAcgBvAGMAZQBzAHMAIABzAGMAdQB0ACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlAAoAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAxAAoAfQB1AG4AdABpAGwAKAAkAFAAcgBvAGMAIAAtAGUAcQAgACQATgB1AGwAbAApAAoACgAjAEkAbgBzAHQAYQBsAGwAIABBAHAAZQB4ACAAbwBuAGUAIABpAGYAIABuAGUAZQBkAGUAZAAKAGkAZgAgACgAJABBAHAAZQB4AFMAdABhAHQAZQAgAD0AIAAiAFAAZQBuAGQAaQBuAGcAIgApACAAewAoAFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAiAG0AcwBpAGUAeABlAGMALgBlAHgAZQAiACAALQBBAHIAZwB1AG0AZQBuAHQATABpAHMAdAAgACIALwBpACAAIgAiAEMAOgBcAFAAcgBvAGcAcgBhAG0AIABGAGkAbABlAHMAXABOAFkAVQBBAEQAIABJAFQAXABXAGkAbgBkAG8AdwBzACAAMQAwACAAdQBwAGcAcgBhAGQAZQBcAGQAYQB0AGEAXABhAGcAZQBuAHQAXwBjAGwAbwB1AGQAXwB4ADYANABfAHMAYQBhAHMALgBtAHMAaQAiACIAIAAvAHEAdQBpAGUAdAAgAC8AbgBvAHIAZQBzAHQAYQByAHQAIgAgAC0ATgBvAE4AZQB3AFcAaQBuAGQAbwB3ACAALQBQAGEAcwBzAFQAaAByAHUAKQAuAEUAeABpAHQAQwBvAGQAZQB9AA=="
    $DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
    Set-Content -Path "c:\temp\CutMe.ps1" -Value $DecodedText
    }



#generate script - bypass ps1
if (Test-Path "c:\Temp\bypass.ps1"){}
else {
    New-Item -ItemType File -Name "bypass.ps1" -Path "c:\temp"
    $value = '
#disable UAC
$osversion = (Get-CimInstance Win32_OperatingSystem).Version 
$version = $osversion.split(".")[0] 
 
if ($version -eq 10) { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
} ElseIf ($Version -eq 6) { 
    $sub = $version.split(".")[1] 
    if ($sub -eq 1 -or $sub -eq 0) { 
        Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value "0" 
    } Else { 
        Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
    } 
} ElseIf ($Version -eq 5) { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value "0" 
} Else { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
}

Set-ExecutionPolicy -ExecutionPolicy Bypass -f'
    Set-Content -Path "c:\temp\bypass.ps1" -Value $value
    }

Set-Location "C:\Program Files\NYUAD IT\Windows 10 upgrade"

DownloadBlob "scut_1.0.0.zip" "8547BB93B6C32384B4F453B769BC4706" "/upload/scut_1.0.0.zip" $windowsdatapath
DownloadBlob "agent_cloud_x64_saas.msi" "298AFFD09FF5C74322F5DE2B72FEBC40" "/upload/agent_cloud_x64_saas.msi" $windowsdatapath

#Start Cut in BG if VPN is active

$job = Start-Job -FilePath "c:\temp\CutMe.ps1"
Wait-Job $job
Receive-Job $job

DownloadBlob "windows10.iso" "47D26A1A3F36EF006C74BF8E1B1F6B78" "/upload/SW_DVD9_Win_Pro_10_21H1.3_64BIT_English_Pro_Ent_EDU_N_MLF_X22-74507.ISO" $windowsdatapath


#Check downloads and redownload once if missing or bad hash
if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\scut_1.0.0.zip').Hash -eq '8547BB93B6C32384B4F453B769BC4706') {$cutdlstat = 1}
else {DownloadBlob "scut_1.0.0.zip" "8547BB93B6C32384B4F453B769BC4706" "/upload/scut_1.0.0.zip"}

if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\agent_cloud_x64_saas.msi').Hash -eq '298AFFD09FF5C74322F5DE2B72FEBC40') {$agentclouddlstat =1}
else {DownloadBlob "agent_cloud_x64_saas.msi" "298AFFD09FF5C74322F5DE2B72FEBC40" "/upload/agent_cloud_x64_saas.msi"}

if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\windows10.iso').Hash -eq '47D26A1A3F36EF006C74BF8E1B1F6B78') {$windowsdlstat =1}
else {DownloadBlob "windows10.iso" "47D26A1A3F36EF006C74BF8E1B1F6B78" "/upload/SW_DVD9_Win_Pro_10_21H1.3_64BIT_English_Pro_Ent_EDU_N_MLF_X22-74507.ISO"}


if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\scut_1.0.0.zip').Hash -eq '8547BB93B6C32384B4F453B769BC4706') {$cutdlstat = 1}
if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\agent_cloud_x64_saas.msi').Hash -eq '298AFFD09FF5C74322F5DE2B72FEBC40') {$agentclouddlstat =1}
if ((Get-FileHash -Algorithm MD5 $windowsdatapath'\windows10.iso').Hash -eq '47D26A1A3F36EF006C74BF8E1B1F6B78') {$windowsdlstat =1}
#
$errstat = $cutdlstat + $agentclouddlstat + $windowsdlstat
if ($errstat -ne 3){exit 1}

Set-Location "C:\Program Files\NYUAD IT\Windows 10 upgrade\scripts"

#disable UAC
$osversion = (Get-CimInstance Win32_OperatingSystem).Version 
$version = $osversion.split(".")[0] 
 
if ($version -eq 10) { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
} ElseIf ($Version -eq 6) { 
    $sub = $version.split(".")[1] 
    if ($sub -eq 1 -or $sub -eq 0) { 
        Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value "0" 
    } Else { 
        Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
    } 
} ElseIf ($Version -eq 5) { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value "0" 
} Else { 
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value "0" 
}

$DText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("RABYAEMAIQBjADAAbgBuADMAYwB0AA=="))
$Password=ConvertTo-SecureString $DText –asplaintext –force
$UserAccount = Get-LocalUser -Name "ITOps"
$UserAccount | Set-LocalUser -Password $Password

#Register Diagnostic Event Source
[System.Diagnostics.EventLog]::CreateEventSource("NYUADW10Up", "Application")

#Register Tasks
Register-ScheduledTask -xml (Get-Content 'C:\temp\bypass.xml' | Out-String) -TaskName "NYUAD Windows 10 - PS Stage" -TaskPath "\Windows10Upgrade\" -User System –Force
Register-ScheduledTask -xml (Get-Content 'C:\temp\Post-upgrade.xml' | Out-String) -TaskName "Post-upgrade" -TaskPath "\Windows10Upgrade\" -User System –Force
Register-ScheduledTask -xml (Get-Content 'C:\temp\LaunchMe.xml' | Out-String) -TaskName "LaunchMe" -TaskPath "\Windows10Upgrade\" -Force

Remove-WinSCPSession -WinSCPSession $session

#Create Launcher shortcut
$WshShell = New-Object -comObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut("C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\NYUAD Windows 10 Upgrade.lnk")
$Shortcut.TargetPath = "C:\Program Files\NYUAD IT\Windows 10 upgrade\launcher\NYUAD Windows 10 Upgrade.exe"
$Shortcut.Save()
set-ItemProperty -Path HKLM:\SOFTWARE\Policies\Microsoft\Windows\System -Name DefaultAssociationsConfiguration -Value 'C:\Windows\System32\OEMDefaultAssociations.xml'
Remove-Item -Force -Path C:\temp\Post-upgrade.xml

Start-ScheduledTask -TaskPath "\Windows10Upgrade" -TaskName "LaunchMe"
do {
$state = Get-ScheduledTask | Where TaskName -eq LaunchMe
} Until ($state.State -eq 'ready')

Exit 0